---
// HeroCarousel.astro

// Sample slides - using public assets for better live site reliability
const slides = [
  {
    image: '/assets/Gardens1.jpg',
    alt: 'Slide 1'
  },
  {
    image: '/assets/Anchored2024.jpg',
    alt: 'Slide 2'
  },
  {
    image: '/assets/QiyamNights2024.jpg',
    alt: 'Slide 3'
  }
];
---

<div class="relative w-full h-[500px] md:h-[600px] lg:h-[700px] overflow-hidden" id="hero-carousel">
  <!-- Slides -->
  <div 
    class="flex w-full h-full transition-transform duration-700 ease-in-out"
    id="slides-container"
  >
    {slides.map((slide, index) => (
      <div class="w-full h-full flex-shrink-0 relative">
        <img
          src={slide.image}
          alt={slide.alt}
          class="w-full h-full object-cover"
        />
        <!-- Overlay for better text readability -->
        <div class="absolute inset-0 bg-black/20"></div>
      </div>
    ))}
  </div>

  <!-- Content overlay -->
  <div class="absolute inset-0 flex items-center justify-center">
    <div class="text-center text-white px-4 max-w-4xl">
      <!-- <p class="text-xl p-2">Assalamu Alaykum</p> -->
      <h1 class="text-6xl md:text-6xl font-bold mb-6">
        WELCOME TO RIHLAH INSTITUTE
      </h1>
      <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto">
        Giving life to spiritually enriching journeys grounded in knowledge.
    
      </p>
    </div>
  </div>

  <!-- Slide indicators -->
  <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex space-x-3" id="indicators">
    {slides.map((_, index) => (
      <button
        class="w-3 h-3 rounded-full transition-all duration-300 bg-white/50 hover:bg-white/75 indicator-btn"
        data-slide={index}
        aria-label={`Go to slide ${index + 1}`}
      />
    ))}
  </div>
</div>

<script>
  // Carousel functionality
  let currentSlide = 0;
  const totalSlides = document.querySelectorAll('#slides-container > div').length;
  const slidesContainer = document.getElementById('slides-container');
  const indicators = document.querySelectorAll('.indicator-btn');
  let autoScrollInterval;
  
  // Touch swipe variables
  let touchStartX = 0;
  let touchEndX = 0;

  // Function to go to a specific slide
  function goToSlide(index) {
    currentSlide = index;
    if (slidesContainer) {
      slidesContainer.style.transform = `translateX(-${currentSlide * 100}%)`;
    }
    
    // Update indicators
    indicators.forEach((indicator, i) => {
      if (i === currentSlide) {
        indicator.classList.remove('bg-white/50');
        indicator.classList.add('bg-white', 'scale-125');
      } else {
        indicator.classList.remove('bg-white', 'scale-125');
        indicator.classList.add('bg-white/50');
      }
    });
  }

  // Function to go to next slide
  function nextSlide() {
    const next = (currentSlide + 1) % totalSlides;
    goToSlide(next);
  }

  // Function to go to previous slide
  function prevSlide() {
    const prev = (currentSlide - 1 + totalSlides) % totalSlides;
    goToSlide(prev);
  }

  // Auto-scroll functionality
  function startAutoScroll() {
    autoScrollInterval = setInterval(nextSlide, 16000);
  }

  function stopAutoScroll() {
    if (autoScrollInterval) {
      clearInterval(autoScrollInterval);
    }
  }

  // Touch swipe handlers
  function handleTouchStart(e) {
    touchStartX = e.changedTouches[0].screenX;
  }

  function handleTouchEnd(e) {
    touchEndX = e.changedTouches[0].screenX;
    handleSwipe();
  }

  function handleSwipe() {
    const swipeThreshold = 50; // Minimum distance to trigger slide change
    const diff = touchStartX - touchEndX;

    if (Math.abs(diff) > swipeThreshold) {
      stopAutoScroll();
      if (diff > 0) {
        // Swiped left, go to next slide
        nextSlide();
      } else {
        // Swiped right, go to previous slide
        prevSlide();
      }
      startAutoScroll(); // Restart auto-scroll after swipe
    }
  }

  // Initialize carousel
  function initCarousel() {
    // Set initial slide
    goToSlide(0);
    
    // Add click listeners to indicators
    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => {
        stopAutoScroll();
        goToSlide(index);
        startAutoScroll(); // Restart auto-scroll after manual interaction
      });
    });

    // Add touch swipe listeners
    const carousel = document.getElementById('hero-carousel');
    if (carousel) {
      carousel.addEventListener('touchstart', handleTouchStart, false);
      carousel.addEventListener('touchend', handleTouchEnd, false);
      
      // Pause auto-scroll on hover
      carousel.addEventListener('mouseenter', stopAutoScroll);
      carousel.addEventListener('mouseleave', startAutoScroll);
    }

    // Start auto-scroll
    startAutoScroll();
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCarousel);
  } else {
    initCarousel();
  }

  // Cleanup on page unload
  window.addEventListener('beforeunload', stopAutoScroll);
</script>